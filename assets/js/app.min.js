!function(){var a=function(a){var e=this;return e.data=[],e.rooms=[],e.toParams=function(a){var e="",t,n,i,r,o,l,c;for(t in a)if(n=a[t],n instanceof Array)for(c=0;c<n.length;++c)o=n[c],i=t+"["+c+"]",l={},l[i]=o,e+=param(l)+"&";else if(n instanceof Object)for(r in n)o=n[r],i=t+"["+r+"]",l={},l[i]=o,e+=param(l)+"&";else void 0!==n&&null!==n&&(e+=encodeURIComponent(t)+"="+encodeURIComponent(n)+"&");return e.length?e.substr(0,e.length-1):e},e.parseRooms=function(){e.rooms.length=0;for(var a=0;a<e.data.acf.panels[0].panel.length;a++){var t={};t.id=e.data.ID,t.title=e.data.acf.panels[0].panel[a].panel_title,t.content=e.data.acf.panels[0].panel[a].panel_content,t.img=e.data.acf.panels[0].panel[a].img,t.banos=e.data.acf.panels[0].panel[a].banos,t.camas=e.data.acf.panels[0].panel[a].camas,t.priceo=void 0==e.data.acf.panels[0].panel[a].precio?parseInt(e.data.acf.panels[0].panel[a].Precio):parseInt(e.data.acf.panels[0].panel[a].precio),t.unavalaible=[],t.reservation={checkinDate:new Date,checkoutDate:new Date},t.disableBooking=void 0==e.data.acf.panels[0].panel[a]["disable-booking"]?!1:e.data.acf.panels[0].panel[a]["disable-booking"],t.disableCheckDisponible=void 0==e.data.acf.panels[0].panel[a]["disable-check-disponible"]?!1:e.data.acf.panels[0].panel[a]["disable-check-disponible"],t.disableDatepicker=void 0==e.data.acf.panels[0].panel[a]["disable-datepicker"]?!1:e.data.acf.panels[0].panel[a]["disable-datepicker"],t.disablePaypal=void 0==e.data.acf.panels[0].panel[a]["disable-paypal"]?!1:e.data.acf.panels[0].panel[a]["disable-paypal"],t.disableCheckinoutDates=void 0==e.data.acf.panels[0].panel[a]["disable-checkinout-dates"]?!1:e.data.acf.panels[0].panel[a]["disable-checkinout-dates"],t.calendar1Opened=!1,t.calendar2Opened=!1;for(var n=e.data.acf.panels[0].panel[a].unavalaible_dates.split(","),i=0;i<n.length;i++)if(null!=n[i]&&""!==n[i]){var r=n[i].split("-");t.unavalaible.push({from:moment(r[0],"DD/MM/YY"),to:moment(r[1],"DD/MM/YY").add(1,"d")})}e.calculatePrice(t),e.rooms.push(t)}},e.disabledDate=function(a,e,t){if("day"!==t||void 0==a)return"";e=moment(e);for(var n=0;n<a.unavalaible.length;n++)if(a.unavalaible[n].from<=e&&a.unavalaible[n].to>=e)return"disabled";return""},e.validation=function(a,e){var t=/^([A-Za-z\.\-\+\_]){1,}@[A-Za-z\.\-\+\_]{1,}\.[A-Za-z\.\-\+\_]{1,}$/g;if(void 0==a.reservation.email||!t.test(a.reservation.email))return alert("Invalid email"),!1;var n=/^[0-9\-\+]{1,}$/g;if(void 0==a.reservation.phone||!n.test(a.reservation.phone))return alert("Invalid phone"),!1;var i=/^[a-zA-Z\- ]{3,}$/g;if(void 0==a.reservation.name||!i.test(a.reservation.name))return alert("Invalid name"),!1;if(a.reservation.checkinDate>a.reservation.checkoutDate)return alert("Invalid dates"),!1;if(2===e||1===e)for(var r=moment(a.reservation.checkinDate),o=moment(a.reservation.checkoutDate),l=0;l<a.unavalaible.length;l++){if(r>=a.unavalaible[l].from&&r<a.unavalaible[l].to)return alert("Invalid checkin date (not available)"),!1;if(o>=a.unavalaible[l].from&&o<a.unavalaible[l].to)return alert("Invalid checkout date (not available)"),!1}return!0},e.reserve=function(t,n,i){if(e.validation(t,i))if(2===i)e.checkoutPaypal(t);else{var r={title:t.title,checkinDate:moment(t.reservation.checkinDate).format("DD/MM/YYYY"),checkoutDate:moment(t.reservation.checkoutDate).format("DD/MM/YYYY"),email:t.reservation.email,phone:t.reservation.phone,price:t.reservation.price,name:t.reservation.name,subject:n};a({method:"POST",url:"/contact-form.php",data:e.toParams(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){console.log(a),alert(a.message)})}},e.calculatePrice=function(a){if(void 0!=a){var e=(a.reservation.checkoutDate-a.reservation.checkinDate)/864e5+1;a.reservation.price=e*a.priceo}},e.checkoutPaypal=function(a){var t={cmd:"_cart",business:"hola-facilitator@sergiofores.com",upload:"1",rm:"2",charset:"utf-8"};t.item_number_1=a.id,t.item_name_1=e.data.title+", "+a.title+", "+moment(a.reservation.checkinDate).format("DD.MM.YYYY")+"-"+moment(a.reservation.checkoutDate).format("DD.MM.YYYY"),t.quantity_1=a.reservation.price/a.priceo,t.amount_1=a.priceo;var n=$("<form/></form>");n.attr("action","https://www.paypal.com/cgi-bin/webscr"),n.attr("method","POST"),n.attr("style","display:none;"),e.addFormFields(n,t),$("body").append(n),n.submit(),n.remove()},e.addFormFields=function(a,e){null!=e&&$.each(e,function(e,t){if(null!=t){var n=$("<input></input>").attr("type","hidden").attr("name",e).val(t);a.append(n)}})},e},e=function(a,e){e.getData(),a.rooms=e.rooms,a.disabledDate=e.disabledDate,a.reserve=e.reserve,a.calculatePrice=e.calculatePrice,a.now=new Date,a.open=function(a,e,t){t.preventDefault(),t.stopPropagation(),1===e?a.calendar1Opened=!0:a.calendar2Opened=!0}},t=angular.module("roomsModule",["ui.bootstrap"]);t.factory("ReservationSvc",["$http",a]),t.controller("ReservationCtrl",["$scope","ReservationSvc",e])}();